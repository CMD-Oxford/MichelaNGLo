<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Example</title>
    <style>
        pre code {
          background-color: #eee;
          border: 1px solid #999;
          display: block;
          padding: 20px;
        }
    </style>
</head>
<body style="background-color: #eeeeee">
<h1>Check out my protein</h1>
<p>This is from a PyMOL view. <button onClick="javascript:saveImg()">Save</button></p>

<div style="max-width: 800px;"><div id="viewport" style="width:100%; height: 0; padding-bottom: 100%;"></div></div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.rawgit.com/arose/ngl/v0.10.4-1/dist/ngl.js" type="text/javascript"></script>


//THIS CODE WAS MADE WITH THE MAKO TEMPLATE
    <script type="text/javascript">

$( document ).ready(function () {
    window.myData={current_index: 0, variants: []};
    myData.pdbs=['rcsb://1UBQ'];


function show_region(ab,ad) {
	protein.removeAllRepresentations();
	var schemeId = NGL.ColormakerRegistry.addSelectionScheme([["green", ab.toString()+'-'+ad.toString()],["white", "*"]]);
	protein.addRepresentation( "cartoon", {color: schemeId });
	protein.autoView();
}

function show_residue(resi) {
    // there should only be two representations...
    for (var i=2; i < protein.reprList.length; i++) {
        protein.removeRepresentation(protein.reprList[i]);
    }
    var selection = new NGL.Selection( resi );
    var schemeId = NGL.ColormakerRegistry.addSelectionScheme([
        ["hotpink",'_C'],["blue",'_N'],["red",'_O'],["white",'_H'],["yellow",'_S'],["orange","*"]
    ]);
    var radius = 5;
    var atomSet = protein.structure.getAtomSetWithinSelection( selection, radius );
    // expand selection to complete groups
    var atomSet2 = protein.structure.getAtomSetWithinGroup( atomSet );
    licoriceRep = protein.addRepresentation( "licorice", { sele: atomSet2.toSeleString()} );
    hyperRep = protein.addRepresentation( "hyperball", { sele: resi, color: schemeId} );
    window.zoom=atomSet2.toSeleString();
    protein.autoView(window.zoom, 2000);
}

//save button
    $('#save_button').click(function () {
   stage.makeImage( {trim: true, antialias: true, transparent: false }).then(function (img) {window.img=img; NGL.download(img);});
});

//lipid button

function load_file(index) { //has the potential of having structure toggle.
    if (typeof index != "number") {index = myData.current_index;} //"undefined"


	// cases...
	if ( (index != myData.current_index) && window.stage) { //new model. Force reset
		stage.removeAllComponents();
	} else if (! window.stage) {
	    var pdb=myData.pdbs[index];
		window.stage = new NGL.Stage( "viewport",{backgroundColor: "white"});
	} else {
		//nothing to be done.
		return true;
	}
	stage.loadFile(pdb).then(function (protein) {
	   myData.protein=protein;
		   //define colors
		var nonCmap = {'N': '0x3333ff', 'O': '0xff4c4c', 'S': '0xff3333'};
		var sermap={};
		var chainmap={'A': '0x00ffff'};
		var resmap={'A12': '0xff00ff', 'A15': '0x00ff7f', 'A58': '0xff00ff', 'A64': '0x00ff7f', 'A71': '0x00ff7f'};
		var schemeId = NGL.ColormakerRegistry.addScheme(function (params) {
			this.atomColor = function (atom) {
				chainid=atom.chainid;
				if (! isNaN(parseFloat(chainid))) {chainid=atom.chainname} // hack for chainid/chainIndex/chainname issue if the structure is loaded from string.
				if (atom.serial in sermap)  {return +sermap[atom.serial]}
				else if (atom.element in nonCmap) {return +nonCmap[atom.element]}
				else if (atom.element in nonCmap) {return +nonCmap[atom.element]}
				else if (chainid+atom.resno in resmap) {return +resmap[chainid+atom.resno]}
				else if (chainid in chainmap) {return +chainmap[chainid]}
				else {return 0x7b7d7d} //black as the darkest error!
			};
		});

		//representations
        
        protein.removeAllRepresentations();
            var sticks = new NGL.Selection( "1:A.N or 1:A.CA or 1:A.C or 1:A.O or 1:A.CB or 1:A.CG or 1:A.SD or 1:A.CE or 39:A.N or 39:A.CA or 39:A.C or 39:A.O or 39:A.CB or 39:A.CG or 39:A.OD1 or 39:A.OD2 or 65:A.N or 65:A.CA or 65:A.C or 65:A.O or 65:A.CB or 65:A.OG" );
            var cartoon = new NGL.Selection( "8:A or 47:A or 61:A or 66:A or 19:A or 12:A or 44:A or 51:A or 53:A or 30:A or 31:A or 20:A or 38:A or 45:A or 68:A or 76:A or 75:A or 29:A or 72:A or 34:A or 4:A or 56:A or 57:A or 33:A or 35:A or 69:A or 54:A or 6:A or 48:A or 24:A or 18:A or 50:A or 22:A or 62:A or 23:A or 65:A or 70:A or 41:A or 74:A or 28:A or 21:A or 40:A or 64:A or 17:A or 42:A or 1:A or 43:A or 58:A or 5:A or 15:A or 63:A or 67:A or 46:A or 59:A or 60:A or 36:A or 10:A or 73:A or 71:A or 16:A or 32:A or 2:A or 52:A or 3:A or 13:A or 7:A or 9:A or 11:A or 14:A or 37:A or 55:A or 26:A or 49:A or 27:A or 25:A or 39:A" );
            myData.cartoonRepresentation = protein.addRepresentation( "cartoon", {color: schemeId,  sele: cartoon.string, smoothSheet: true} );

		//orient
		myData.main_view = (new NGL.Matrix4).fromArray([12.024881802724254, -31.20222113459176, -22.625490513959228, 0.0, 6.443973431956869, 24.99511897117639, -31.04533414721094, 0.0, 37.99961150402132, 5.635197222411714, 12.424418723258626, 0.0, -30.626810074, -30.357639313, -19.690916061, 1.0]);
		stage.viewerControls.orient(myData.main_view);
	});
}

    load_file();

// Handle window resizing
window.addEventListener( "resize", function( event ){
    stage.handleResize();
}, false );

});//doc-ready
    </script>




</body>
</html>
